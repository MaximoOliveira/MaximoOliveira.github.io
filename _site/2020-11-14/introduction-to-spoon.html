<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Máximo Oliveira</title>

  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Libre+Baskerville:400,400i,700">
  
  <!-- Font Awesome -->
  <link rel="stylesheet" type="text/css" href="/assets/css/fontawesome-all.min.css">

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon.ico">

  <!-- Google Analytics -->
  
  <script>
      (function(i, s, o, g, r, a, m) {
          i['GoogleAnalyticsObject'] = r;
          i[r] = i[r] || function() {
              (i[r].q = i[r].q || []).push(arguments)
          }, i[r].l = 1 * new Date();
          a = s.createElement(o),
              m = s.getElementsByTagName(o)[0];
          a.async = 1;
          a.src = g;
          m.parentNode.insertBefore(a, m)
      })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

      ga('create', 'UA-182683393-1', 'auto');
      ga('send', 'pageview');

  </script>
  

</head>


  <body>
    <nav class="nav">
      <div class="nav-container">
        <a href="/">
          <h2 class="nav-title">Máximo Oliveira</h2>
        </a>
        <ul>
          <li><a href="/">About</a></li>
          <li><a href="/posts">Posts</a></li>
          <li><a href="/assets/Maximo_Oliveira_CV.pdf">CV</a></li>
        </ul>
    </div>
  </nav>

    <main>
      <div class="post">
  <div class="post-info">
    <span>Written by</span>
    
        Máximo Oliveira
    

    
      <br>
      <span>on&nbsp;</span><time datetime="2020-11-14 00:00:00 +0000">November 14, 2020</time>
    
  </div>

  <h1 class="post-title">Introduction to Code Transformation in Java using Spoon</h1>
  <div class="post-line"></div>

  <p>This post is an attempt to guide people that want to use the Spoon library for the first time to transform Java code.</p>

<p>In this tutorial, I´ll cover what Spoon is and how to set it up along with a small example of its usage.</p>

<h1 id="what-is-spoon">What is Spoon?</h1>
<p>From the <a href="http://spoon.gforge.inria.fr/">spoon documentation</a> we have that:</p>

<figure class="highlight"><pre><code class="language-markdown" data-lang="markdown">"Spoon is an open-source library to analyze, rewrite, transform, transpile Java
source code. It parses source files to build a well-designed AST with powerful
analysis and transformation API..."</code></pre></figure>

<p>This tells us that Spoon converts our Java program into an AST, which then allows us to filter the parts of the program we want to analyze/transform more easily.</p>

<h1 id="but-what-is-an-ast">But what is an AST?</h1>
<p>An AST (Abstract Syntax Tree) is a tree representation of source code. I won´t dive deep into this concept as there are multiple other sources that explain it very well, like <a href="https://www.twilio.com/blog/abstract-syntax-trees">this one</a>, or <a href="https://ruslanspivak.com/lsbasi-part7/">this one</a>.</p>

<p>Let’s see the AST representation of the following block of code that compares two variables and stores one of its values on a pre-existing variable named <code class="language-plaintext highlighter-rouge">info</code>, based on the result of the comparison.</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java">  <span class="k">if</span><span class="o">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span><span class="o">)</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span>
  <span class="k">else</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">y</span><span class="o">;</span></code></pre></figure>

<p>We have that the AST representation is:
<br />
<img src="..\assets\img\ast1.png" alt="ast-representation" />
<em>AST representation of the previous block of code</em></p>

<p>We can see that the child node <code class="language-plaintext highlighter-rouge">&gt;</code> represents the binary expression inside the if statement. If this expression evaluates to true, the second child node will be executed, else it will be the third.</p>

<p>We can clearly understand how the previous block of code works, but how can we be sure that it is working correctly and that it covers all possible cases? One could argue that the developer in charge of writing that code also covered it with test cases and ensured it is working fully as expected. However, a few months later a new input causes the program to fail and after carefull inspection, the debugger finds that the code is missing an equality sign after <code class="language-plaintext highlighter-rouge">&gt;</code>, so the correct code would be:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java">  <span class="k">if</span><span class="o">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">y</span><span class="o">)</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">x</span><span class="o">;</span>
  <span class="k">else</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">y</span><span class="o">;</span></code></pre></figure>


</div>



<div class="pagination">
  
  

  <a href="#" class="top">Top</a>
</div>
    </main>

  </body>
</html>
